generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
}

datasource db {
  provider   = "postgresql"
  url        = env("DATABASE_URL")
  directUrl  = env("DIRECT_URL")
  extensions = [uuid_ossp(map: "uuid-ossp", schema: "extensions"), vector]
}

model User {
  id                    String                    @id @default(cuid())
  email                 String                    @unique
  phone                 String?                   @unique
  passwordHash          String?
  googleId              String?                   @unique
  appleId               String?                   @unique
  firstName             String
  lastName              String
  displayName           String?
  avatarUrl             String?
  dateOfBirth           DateTime?
  gender                Gender?
  fitnessGoal           FitnessGoal?
  activityLevel         ActivityLevel?
  heightCm              Float?
  currentWeightKg       Float?
  targetWeightKg        Float?
  fitnessLevel          DifficultyLevel           @default(BEGINNER)
  role                  UserRole                  @default(USER)
  language              String                    @default("en")
  measurementUnit       String                    @default("metric")
  notificationsEnabled  Boolean                   @default(true)
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  lastActiveAt          DateTime                  @default(now())
  onboardingCompletedAt DateTime?
  bannedAt              DateTime?
  uploadBanReason       String?
  canSeeMarketplace     Boolean                   @default(true)
  invitedByCode         String?
  invitedByTrainerId    String?
  aiUsageEvents         AIUsageEvent[]
  contentViolations     ContentViolation[]
  conversations         ConversationParticipant[]
  dailyReadinessLogs    DailyReadinessLog[]
  featureUsageLimits    FeatureUsageLimit[]
  mealLogs              MealLog[]
  mealPlans             MealPlan[]
  sentMessages          Message[]                 @relation("SentMessages")
  muscleRecoveryStatus  MuscleRecoveryStatus[]
  progressLogs          ProgressLog[]
  progressPhotos        ProgressPhoto[]
  streaks               Streak[]
  subscription          Subscription?
  surveyResponses       SurveyResponse[]
  trainers              TrainerClient[]           @relation("ClientTrainers")
  scheduledCalls        ScheduledCall[]           @relation("ScheduledCalls")
  trainerProfile        TrainerProfile?
  aiPreferences         UserAIPreference?
  achievements          UserAchievement[]
  bodyComposition       UserBodyComposition?
  equipment             UserEquipment[]
  equipmentInventory    UserEquipmentInventory?
  exerciseCapability    UserExerciseCapability?
  fastingProfile        UserFastingProfile?
  goalsProfile          UserGoalsProfile?
  healthProfile         UserHealthProfile?
  lifestyleProfile      UserLifestyleProfile?
  movementScreen        UserMovementScreen?
  nutritionProfile      UserNutritionProfile?
  trainingHistory       UserTrainingHistory?
  workoutFeedback       WorkoutFeedback[]
  workoutLogs           WorkoutLog[]
  workoutPlans          WorkoutPlan[]
  receivedMessages      Message[]                 @relation("ReceivedMessages")

  @@index([email])
  @@index([phone])
  @@index([role])
}

model UserEquipment {
  id        String        @id @default(cuid())
  userId    String
  equipment EquipmentType
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, equipment])
}

model UserAIPreference {
  id                   String   @id @default(cuid())
  userId               String   @unique
  isVegetarian         Boolean  @default(false)
  isVegan              Boolean  @default(false)
  isKeto               Boolean  @default(false)
  isPescatarian        Boolean  @default(false)
  allergies            String[] @default([])
  dislikes             String[] @default([])
  healthConditions     String[] @default([])
  medications          String[] @default([])
  preferLocalFoods     Boolean  @default(true)
  budgetLevel          String   @default("moderate")
  cookingSkillLevel    String   @default("intermediate")
  maxCookingTime       Int      @default(30)
  availableEquipment   String[] @default([])
  injuries             String[] @default([])
  preferredWorkoutTime String?
  ramadanFastingDays   String[] @default([])
  ramadanIftarTime     String?
  ramadanModeEnabled   Boolean  @default(false)
  ramadanSuhoorTime    String?
  ramadanWorkoutTiming String   @default("after_iftar")
  workoutDurationMins  Int      @default(45)
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Exercise {
  id               String                 @id @default(cuid())
  externalId       String                 @unique
  nameEn           String
  nameAr           String
  descriptionEn    String?
  descriptionAr    String?
  category         ExerciseCategory
  primaryMuscle    MuscleGroup
  secondaryMuscles MuscleGroup[]
  equipment        EquipmentType[]
  difficulty       DifficultyLevel
  thumbnailUrl     String?
  videoUrl         String?
  instructionsEn   String[]
  instructionsAr   String[]
  tipsEn           String[]
  tipsAr           String[]
  faqsEn           Json?                  // Array of {question, answer} objects
  faqsAr           Json?                  // Array of {question, answer} objects
  isTimeBased      Boolean                @default(false)
  defaultSets      Int                    @default(3)
  defaultReps      Int?                   @default(10)
  defaultDuration  Int?
  defaultRest      Int                    @default(60)
  tags             String[]
  embedding        Unsupported("vector")?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  exerciseLogs     ExerciseLog[]
  programExercises ProgramExercise[]
  workoutExercises WorkoutExercise[]

  @@index([primaryMuscle])
  @@index([category])
  @@index([difficulty])
}

model WorkoutPlan {
  id            String          @id @default(cuid())
  userId        String
  trainerId     String?
  nameEn        String
  nameAr        String
  descriptionEn String?
  descriptionAr String?
  durationWeeks Int             @default(4)
  daysPerWeek   Int             @default(4)
  difficulty    DifficultyLevel
  goal          FitnessGoal
  isActive      Boolean         @default(true)
  isAIGenerated Boolean         @default(false)
  startDate     DateTime?
  endDate       DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  workouts      Workout[]
  trainer       TrainerProfile? @relation(fields: [trainerId], references: [id])
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
}

model Workout {
  id               String            @id @default(cuid())
  planId           String
  weekNumber       Int
  dayOfWeek        Int
  nameEn           String
  nameAr           String
  focusMuscles     MuscleGroup[]
  estimatedMinutes Int               @default(45)
  plan             WorkoutPlan       @relation(fields: [planId], references: [id], onDelete: Cascade)
  exercises        WorkoutExercise[]
  logs             WorkoutLog[]

  @@index([planId])
  @@index([weekNumber, dayOfWeek])
}

model WorkoutExercise {
  id          String   @id @default(cuid())
  workoutId   String
  exerciseId  String
  order       Int
  sets        Int
  reps        Int?
  duration    Int?
  restSeconds Int      @default(60)
  notesEn     String?
  notesAr     String?
  exercise    Exercise @relation(fields: [exerciseId], references: [id])
  workout     Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  @@index([workoutId])
  @@index([exerciseId])
}

model WorkoutLog {
  id              String           @id @default(cuid())
  userId          String
  workoutId       String?
  manualName      String?
  scheduledDate   DateTime
  startedAt       DateTime?
  completedAt     DateTime?
  status          WorkoutStatus    @default(SCHEDULED)
  totalVolume     Float?
  durationMinutes Int?
  caloriesBurned  Int?
  rating          Int?
  notes           String?
  exerciseLogs    ExerciseLog[]
  feedback        WorkoutFeedback?
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  workout         Workout?         @relation(fields: [workoutId], references: [id])

  @@index([userId])
  @@index([scheduledDate])
  @@index([status])
  @@index([userId, completedAt]) // For workout history queries
  @@index([userId, status, scheduledDate]) // For filtered queries
}

model ExerciseLog {
  id           String     @id @default(cuid())
  workoutLogId String
  exerciseId   String
  completedAt  DateTime   @default(now())
  exercise     Exercise   @relation(fields: [exerciseId], references: [id])
  workoutLog   WorkoutLog @relation(fields: [workoutLogId], references: [id], onDelete: Cascade)
  sets         SetLog[]

  @@index([workoutLogId])
  @@index([exerciseId])
  @@index([workoutLogId, exerciseId]) // For batch lookups
}

model SetLog {
  id            String      @id @default(cuid())
  exerciseLogId String
  setNumber     Int
  reps          Int?
  weightKg      Float?
  duration      Int?
  rpe           Int?
  completedAt   DateTime    @default(now())
  exerciseLog   ExerciseLog @relation(fields: [exerciseLogId], references: [id], onDelete: Cascade)

  @@index([exerciseLogId])
}

model Food {
  id               String                 @id @default(cuid())
  externalId       String?                @unique
  nameEn           String
  nameAr           String
  brandEn          String?
  brandAr          String?
  isEgyptian       Boolean                @default(false)
  availableAt      String[]
  category         String
  subcategory      String?
  servingSizeG     Float
  servingUnit      String                 @default("g")
  calories         Float
  proteinG         Float
  carbsG           Float
  fatG             Float
  fiberG           Float?
  sugarG           Float?
  sodiumMg         Float?
  vitaminAIU       Float?
  vitaminCMg       Float?
  calciumMg        Float?
  ironMg           Float?
  potassiumMg      Float?
  imageUrl         String?
  barcode          String?
  tags             String[]
  embedding        Unsupported("vector")?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  mealFoods        MealFood[]
  plannedMealFoods PlannedMealFood[]

  @@index([category])
  @@index([isEgyptian])
  @@index([barcode])
}

model MealPlan {
  id             String        @id @default(cuid())
  userId         String
  trainerId      String?
  nameEn         String
  nameAr         String
  targetCalories Int
  targetProteinG Int
  targetCarbsG   Int
  targetFatG     Int
  durationDays   Int           @default(7)
  isActive       Boolean       @default(true)
  isAIGenerated  Boolean       @default(false)
  startDate      DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  meals          PlannedMeal[]

  @@index([userId])
  @@index([isActive])
}

model PlannedMeal {
  id        String            @id @default(cuid())
  planId    String
  dayNumber Int
  mealType  MealType
  nameEn    String?
  nameAr    String?
  plan      MealPlan          @relation(fields: [planId], references: [id], onDelete: Cascade)
  foods     PlannedMealFood[]

  @@index([planId])
}

model PlannedMealFood {
  id            String      @id @default(cuid())
  plannedMealId String
  foodId        String
  servings      Float       @default(1)
  food          Food        @relation(fields: [foodId], references: [id])
  plannedMeal   PlannedMeal @relation(fields: [plannedMealId], references: [id], onDelete: Cascade)

  @@index([plannedMealId])
}

model MealLog {
  id            String     @id @default(cuid())
  userId        String
  loggedAt      DateTime   @default(now())
  mealType      MealType
  notes         String?
  photoUrl      String?
  totalCalories Float?
  totalProteinG Float?
  totalCarbsG   Float?
  totalFatG     Float?
  foods         MealFood[]
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([loggedAt])
}

model MealFood {
  id        String  @id @default(cuid())
  mealLogId String
  foodId    String
  servings  Float   @default(1)
  food      Food    @relation(fields: [foodId], references: [id])
  mealLog   MealLog @relation(fields: [mealLogId], references: [id], onDelete: Cascade)

  @@index([mealLogId])
}

model ProgressLog {
  id                     String   @id @default(cuid())
  userId                 String
  loggedAt               DateTime @default(now())
  weightKg               Float?
  bodyFatPercent         Float?
  chestCm                Float?
  waistCm                Float?
  hipsCm                 Float?
  thighCm                Float?
  bicepCm                Float?
  restingHR              Int?
  bloodPressureSystolic  Int?
  bloodPressureDiastolic Int?
  sleepHours             Float?
  stepsCount             Int?
  notes                  String?
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([loggedAt])
}

model ProgressPhoto {
  id                String   @id @default(cuid())
  userId            String
  photoUrl          String
  thumbnailUrl      String?
  angle             String?
  loggedAt          DateTime @default(now())
  notes             String?
  isPublic          Boolean  @default(false)
  sharedWithTrainer Boolean  @default(false)
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([loggedAt])
}

model TrainerProfile {
  id                  String                 @id @default(cuid())
  userId              String                 @unique
  bio                 String?
  specializations     String[]
  yearsExperience     Int                    @default(0)
  instagramHandle     String?
  instagramFollowers  Int?
  monthlyPrice        Int
  averageRating       Float                  @default(0)
  totalReviews        Int                    @default(0)
  status              TrainerStatus          @default(PENDING)
  verifiedAt          DateTime?
  maxClients          Int                    @default(20)
  acceptingClients    Boolean                @default(true)
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  canGiftPremium      Boolean                @default(false)
  commissionRate      Float                  @default(0.20)
  inviteCode          String?                @unique
  inviteUses          Int                    @default(0)
  lastPayoutAt        DateTime?
  tier                TrainerTier            @default(REGULAR)
  totalEarnings       Float                  @default(0)
  availableBalanceEGP Float                  @default(0)
  pendingPayoutEGP    Float                  @default(0)
  certifications      TrainerCertification[]
  clients             TrainerClient[]
  invites             TrainerInvite[]
  user                User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  programs            TrainerProgram[]
  reviews             TrainerReview[]
  transactions        TrainerTransaction[]
  workoutPlans        WorkoutPlan[]
  availability        TrainerAvailability[]
  scheduledCalls      ScheduledCall[]

  @@index([status])
  @@index([averageRating])
  @@index([tier])
  @@index([inviteCode])
}

// Trainer's weekly availability schedule
model TrainerAvailability {
  id          String         @id @default(cuid())
  trainerId   String
  dayOfWeek   Int            // 0=Sunday, 1=Monday, etc.
  startTime   String         // "09:00" format
  endTime     String         // "17:00" format
  slotMinutes Int            @default(30) // Duration of each slot
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  trainer     TrainerProfile @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@unique([trainerId, dayOfWeek, startTime])
  @@index([trainerId])
  @@index([dayOfWeek])
}


model TrainerCertification {
  id          String         @id @default(cuid())
  trainerId   String
  name        String
  issuingBody String
  issueDate   DateTime?
  expiryDate  DateTime?
  documentUrl String?
  isVerified  Boolean        @default(false)
  verifiedAt  DateTime?
  trainer     TrainerProfile @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@index([trainerId])
}

model TrainerClient {
  id                String          @id @default(cuid())
  trainerId         String
  clientId          String
  isActive          Boolean         @default(true)
  startDate         DateTime        @default(now())
  endDate           DateTime?
  notes             String?
  canSeeMarketplace Boolean         @default(true)
  complianceRate    Float           @default(0)
  currentProgramId  String?
  invitedVia        String?
  premiumGifted     Boolean         @default(false)
  programEndDate    DateTime?
  programStartDate  DateTime?
  client            User            @relation("ClientTrainers", fields: [clientId], references: [id], onDelete: Cascade)
  program           TrainerProgram? @relation(fields: [currentProgramId], references: [id])
  trainer           TrainerProfile  @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@unique([trainerId, clientId])
  @@index([trainerId])
  @@index([clientId])
  @@index([isActive])
}

model TrainerInvite {
  id            String         @id @default(cuid())
  trainerId     String
  code          String         @unique
  uses          Int            @default(0)
  maxUses       Int?
  grantsPremium Boolean        @default(false)
  expiresAt     DateTime?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  trainer       TrainerProfile @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@index([trainerId])
  @@index([code])
}

model TrainerProgram {
  id            String                @id @default(cuid())
  trainerId     String
  nameEn        String
  nameAr        String?
  descriptionEn String?
  descriptionAr String?
  durationWeeks Int                   @default(4)
  priceEGP      Int?
  status        ProgramStatus         @default(DRAFT)
  isTemplate    Boolean               @default(false)
  sourceType    String?
  sourcePdfUrl  String?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  nutritionDays ProgramNutritionDay[]
  workoutDays   ProgramWorkoutDay[]
  clients       TrainerClient[]
  trainer       TrainerProfile        @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@index([trainerId])
  @@index([status])
}

model ProgramWorkoutDay {
  id        String            @id @default(cuid())
  programId String
  dayNumber Int
  nameEn    String?
  nameAr    String?
  notesEn   String?
  notesAr   String?
  exercises ProgramExercise[]
  program   TrainerProgram    @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@unique([programId, dayNumber])
  @@index([programId])
}

model ProgramExercise {
  id           String            @id @default(cuid())
  workoutDayId String
  exerciseId   String?
  customNameEn String?
  customNameAr String?
  order        Int
  sets         Int               @default(3)
  reps         String?
  restSeconds  Int               @default(60)
  notesEn      String?
  notesAr      String?
  exercise     Exercise?         @relation(fields: [exerciseId], references: [id])
  workoutDay   ProgramWorkoutDay @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)

  @@index([workoutDayId])
}

model ProgramNutritionDay {
  id             String         @id @default(cuid())
  programId      String
  dayNumber      Int
  notesEn        String?
  notesAr        String?
  targetCalories Int?
  targetProteinG Int?
  targetCarbsG   Int?
  targetFatG     Int?
  meals          ProgramMeal[]
  program        TrainerProgram @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@unique([programId, dayNumber])
  @@index([programId])
}

model ProgramMeal {
  id             String              @id @default(cuid())
  nutritionDayId String
  mealType       MealType
  nameEn         String?
  nameAr         String?
  descriptionEn  String?
  descriptionAr  String?
  calories       Int?
  proteinG       Int?
  carbsG         Int?
  fatG           Int?
  nutritionDay   ProgramNutritionDay @relation(fields: [nutritionDayId], references: [id], onDelete: Cascade)

  @@index([nutritionDayId])
}

model TrainerTransaction {
  id                String            @id @default(cuid())
  trainerId         String
  clientId          String?
  type              TransactionType
  amountEGP         Float
  platformFeeEGP    Float
  trainerEarningEGP Float
  status            TransactionStatus @default(PENDING)
  description       String?
  paymentRef        String?
  createdAt         DateTime          @default(now())
  completedAt       DateTime?
  paidOutAt         DateTime?
  metadata          Json?
  trainer           TrainerProfile    @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@index([trainerId])
  @@index([status])
  @@index([createdAt])
}

model TrainerReview {
  id        String         @id @default(cuid())
  trainerId String
  clientId  String
  rating    Int
  comment   String?
  createdAt DateTime       @default(now())
  trainer   TrainerProfile @relation(fields: [trainerId], references: [id], onDelete: Cascade)

  @@index([trainerId])
}

model Subscription {
  id                   String             @id @default(cuid())
  userId               String             @unique
  tier                 SubscriptionTier   @default(FREE)
  status               SubscriptionStatus @default(ACTIVE)
  priceEGP             Int                @default(0)
  billingCycle         String             @default("monthly")
  startDate            DateTime           @default(now())
  endDate              DateTime?
  trialEndDate         DateTime?
  cancelledAt          DateTime?
  stripeCustomerId     String?
  stripeSubscriptionId String?
  payments             Payment[]
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([tier])
  @@index([status])
}

model Payment {
  id              String       @id @default(cuid())
  subscriptionId  String
  amountEGP       Int
  currency        String       @default("EGP")
  status          String
  stripePaymentId String?
  createdAt       DateTime     @default(now())
  paidAt          DateTime?
  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@index([status])
}

model Conversation {
  id            String                    @id @default(cuid())
  isGroup       Boolean                   @default(false)
  name          String?
  lastMessageAt DateTime?
  createdAt     DateTime                  @default(now())
  participants  ConversationParticipant[]
  messages      Message[]
}

model ConversationParticipant {
  id             String       @id @default(cuid())
  conversationId String
  userId         String
  lastReadAt     DateTime?
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([userId])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  type           MessageType  @default(TEXT)
  content        String
  mediaUrl       String?
  isEdited       Boolean      @default(false)
  isDeleted      Boolean      @default(false)
  createdAt      DateTime     @default(now())
  editedAt       DateTime?
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation("SentMessages", fields: [senderId], references: [id])
  recipients     User[]       @relation("ReceivedMessages")

  @@index([conversationId])
  @@index([senderId])
  @@index([createdAt])
  @@index([conversationId, createdAt]) // For message pagination
}

model Achievement {
  id            String            @id @default(cuid())
  code          String            @unique
  nameEn        String
  nameAr        String
  descriptionEn String
  descriptionAr String
  iconUrl       String?
  badgeColor    String?
  category      String
  requirement   Json
  xpReward      Int               @default(0)
  users         UserAchievement[]
}

model UserAchievement {
  id            String      @id @default(cuid())
  userId        String
  achievementId String
  progress      Float       @default(0)
  unlockedAt    DateTime?
  achievement   Achievement @relation(fields: [achievementId], references: [id])
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@index([userId])
}

model Streak {
  id             String    @id @default(cuid())
  userId         String
  type           String
  currentCount   Int       @default(0)
  longestCount   Int       @default(0)
  lastActivityAt DateTime?
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type])
  @@index([userId])
}

model Video {
  id              String        @id @default(cuid())
  youtubeId       String        @unique
  title           String
  titleAr         String?
  description     String?
  descriptionAr   String?
  category        VideoCategory
  tags            String[]
  durationSeconds Int?
  thumbnailUrl    String?
  vectorData      Json?
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([category])
  @@index([isActive])
}

model Squad {
  id          String           @id @default(cuid())
  name        String
  description String?
  imageUrl    String?
  isPublic    Boolean          @default(true)
  maxMembers  Int              @default(20)
  createdById String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  activities  SquadActivity[]
  challenges  SquadChallenge[]
  members     SquadMember[]

  @@index([isPublic])
}

model SquadMember {
  id       String   @id @default(cuid())
  squadId  String
  userId   String
  role     String   @default("member")
  joinedAt DateTime @default(now())
  squad    Squad    @relation(fields: [squadId], references: [id], onDelete: Cascade)

  @@unique([squadId, userId])
  @@index([userId])
}

model SquadActivity {
  id          String   @id @default(cuid())
  squadId     String
  userId      String
  type        String
  description String
  metadata    Json?
  createdAt   DateTime @default(now())
  squad       Squad    @relation(fields: [squadId], references: [id], onDelete: Cascade)

  @@index([squadId])
  @@index([createdAt])
}

model SquadChallenge {
  id          String   @id @default(cuid())
  squadId     String
  name        String
  description String?
  type        String
  target      Int
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime @default(now())
  squad       Squad    @relation(fields: [squadId], references: [id], onDelete: Cascade)

  @@index([squadId])
  @@index([endDate])
}

model ContentViolation {
  id         String    @id @default(cuid())
  userId     String
  resourceId String
  type       String
  reason     String
  detectedAt DateTime
  reviewedAt DateTime?
  reviewedBy String?
  action     String?
  createdAt  DateTime  @default(now())
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
  @@index([reviewedAt])
}

model AIUsageEvent {
  id             String           @id @default(cuid())
  userId         String
  tier           SubscriptionTier
  featureId      String
  queryType      AIQueryType
  queryText      String?
  responseTimeMs Int?
  successful     Boolean          @default(true)
  satisfaction   Int?
  metadata       Json?
  createdAt      DateTime         @default(now())
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([tier])
  @@index([queryType])
  @@index([createdAt])
}

model Survey {
  id            String           @id @default(cuid())
  code          String           @unique
  title         String
  titleAr       String?
  description   String?
  descriptionAr String?
  questions     Json
  isActive      Boolean          @default(true)
  triggerEvent  String?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  responses     SurveyResponse[]
}

model SurveyResponse {
  id          String   @id @default(cuid())
  surveyId    String
  userId      String
  responses   Json
  completedAt DateTime @default(now())
  metadata    Json?
  survey      Survey   @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([surveyId, userId])
  @@index([surveyId])
  @@index([userId])
}

model FeatureUsageLimit {
  id          String    @id @default(cuid())
  userId      String
  featureId   String
  usedCount   Int       @default(0)
  limitHitAt  DateTime?
  periodStart DateTime  @default(now())
  periodEnd   DateTime
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, featureId, periodStart])
  @@index([userId])
  @@index([featureId])
}

model UserEquipmentInventory {
  id                 String           @id @default(cuid())
  userId             String           @unique
  primaryLocation    TrainingLocation @default(HOME)
  hasGymAccess       Boolean          @default(false)
  gymName            String?
  hasFloorSpace      Boolean          @default(true)
  hasWallSpace       Boolean          @default(true)
  hasPullUpBar       Boolean          @default(false)
  hasDipStation      Boolean          @default(false)
  hasParallettesBars Boolean          @default(false)
  hasDumbbells       Boolean          @default(false)
  dumbbellMinKg      Float?
  dumbbellMaxKg      Float?
  dumbbellIncrement  Float?
  hasBarbell         Boolean          @default(false)
  barbellWeightKg    Float?
  hasPlates          Boolean          @default(false)
  plateMaxTotalKg    Float?
  hasKettlebells     Boolean          @default(false)
  kettlebellWeights  Float[]          @default([])
  hasEZBar           Boolean          @default(false)
  hasBench           Boolean          @default(false)
  benchType          BenchType?
  hasSquatRack       Boolean          @default(false)
  hasPowerRack       Boolean          @default(false)
  hasSmithMachine    Boolean          @default(false)
  hasCableMachine    Boolean          @default(false)
  hasLegPress        Boolean          @default(false)
  hasLegExtension    Boolean          @default(false)
  hasLegCurl         Boolean          @default(false)
  hasLatPulldown     Boolean          @default(false)
  hasSeatedRow       Boolean          @default(false)
  hasChestPress      Boolean          @default(false)
  hasShoulderPress   Boolean          @default(false)
  hasPecDeck         Boolean          @default(false)
  hasTreadmill       Boolean          @default(false)
  hasStatBike        Boolean          @default(false)
  hasRowingMachine   Boolean          @default(false)
  hasResistanceBands Boolean          @default(false)
  bandStrengths      String[]         @default([])
  hasTRX             Boolean          @default(false)
  hasAbWheel         Boolean          @default(false)
  hasFoamRoller      Boolean          @default(false)
  hasYogaMat         Boolean          @default(false)
  hasJumpRope        Boolean          @default(false)
  hasBox             Boolean          @default(false)
  boxHeightsCm       Int[]            @default([])
  hasMedicineBall    Boolean          @default(false)
  medicineBallKg     Float?
  hasStabilityBall   Boolean          @default(false)
  updatedAt          DateTime         @updatedAt
  user               User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserExerciseCapability {
  id                     String   @id @default(cuid())
  userId                 String   @unique
  assessedAt             DateTime @default(now())
  pushUpMaxReps          Int      @default(0)
  pushUpFromKnees        Boolean  @default(false)
  wallPushUp             Boolean  @default(true)
  declinePushUp          Boolean  @default(false)
  diamondPushUp          Boolean  @default(false)
  pikePushUp             Boolean  @default(false)
  handstandPushUp        Boolean  @default(false)
  dipMaxReps             Int      @default(0)
  pullUpMaxReps          Int      @default(0)
  chinUpMaxReps          Int      @default(0)
  canHangFromBar         Boolean  @default(false)
  bodyweightRow          Boolean  @default(false)
  plankHoldSeconds       Int      @default(0)
  sidePlankSeconds       Int      @default(0)
  hollowBodyHold         Boolean  @default(false)
  hangingLegRaise        Boolean  @default(false)
  abWheelRollout         Boolean  @default(false)
  bodyweightSquatMaxReps Int      @default(0)
  canSquatBelowParallel  Boolean  @default(false)
  pistolSquat            Boolean  @default(false)
  bulgarianSplitSquat    Boolean  @default(false)
  lungeMaxReps           Int      @default(0)
  boxJump                Boolean  @default(false)
  boxJumpMaxCm           Int?
  singleLegRDL           Boolean  @default(false)
  hipThrust              Boolean  @default(false)
  nordicCurl             Boolean  @default(false)
  singleLegStandSeconds  Int      @default(0)
  canRun5Min             Boolean  @default(false)
  canRun20Min            Boolean  @default(false)
  burpeeMaxReps          Int      @default(0)
  canTouchToes           Boolean  @default(false)
  canDeepSquatNoHeel     Boolean  @default(false)
  canOverheadSquat       Boolean  @default(false)
  benchPress1RM          Float?
  squat1RM               Float?
  deadlift1RM            Float?
  overheadPress1RM       Float?
  updatedAt              DateTime @updatedAt
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserMovementScreen {
  id                          String   @id @default(cuid())
  userId                      String   @unique
  screenedAt                  DateTime @default(now())
  deepSquatScore              Int      @default(2)
  shoulderMobilityScoreL      Int      @default(2)
  shoulderMobilityScoreR      Int      @default(2)
  activeSLRScoreL             Int      @default(2)
  activeSLRScoreR             Int      @default(2)
  limitedAnkleDorsiflexion    Boolean  @default(false)
  limitedHipFlexion           Boolean  @default(false)
  limitedHipExtension         Boolean  @default(false)
  limitedThoracicExtension    Boolean  @default(false)
  limitedShoulderFlexion      Boolean  @default(false)
  limitedShoulderRotationInt  Boolean  @default(false)
  limitedShoulderRotationExt  Boolean  @default(false)
  limitedHamstringFlexibility Boolean  @default(false)
  limitedWristExtension       Boolean  @default(false)
  hasLeftRightImbalance       Boolean  @default(false)
  strongerSide                String?
  forwardHeadPosture          Boolean  @default(false)
  roundedShoulders            Boolean  @default(false)
  excessiveLordosis           Boolean  @default(false)
  anteriorPelvicTilt          Boolean  @default(false)
  kneeValgus                  Boolean  @default(false)
  notes                       String?
  updatedAt                   DateTime @updatedAt
  user                        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserHealthProfile {
  id                      String       @id @default(cuid())
  userId                  String       @unique
  updatedAt               DateTime     @updatedAt
  hasHeartCondition       Boolean      @default(false)
  hasHighBloodPressure    Boolean      @default(false)
  hasLowBloodPressure     Boolean      @default(false)
  hasDiabetes             Boolean      @default(false)
  diabetesType            Int?
  hasAsthma               Boolean      @default(false)
  hasArthritis            Boolean      @default(false)
  arthritisJoints         String[]     @default([])
  hasOsteoporosis         Boolean      @default(false)
  hasHerniaHistory        Boolean      @default(false)
  hasJointReplacement     Boolean      @default(false)
  jointReplacementDetails String?
  hasNerveIssues          Boolean      @default(false)
  nerveIssueDetails       String?
  hasVertigoBalance       Boolean      @default(false)
  isPregnant              Boolean      @default(false)
  pregnancyTrimester      Int?
  hadRecentSurgery        Boolean      @default(false)
  surgeryDetails          String?
  surgeryDate             DateTime?
  clearedForExercise      Boolean      @default(true)
  takesBloodThinners      Boolean      @default(false)
  takesBetaBlockers       Boolean      @default(false)
  takesInsulin            Boolean      @default(false)
  medicationNotes         String?
  hasDoctorClearance      Boolean      @default(true)
  user                    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  injuries                UserInjury[]
}

model UserInjury {
  id                String            @id @default(cuid())
  healthProfileId   String
  bodyPart          InjuryBodyPart
  side              String?
  injuryType        InjuryType
  severity          InjurySeverity
  occurredAt        DateTime?
  isCurrentlyActive Boolean           @default(true)
  isFullyHealed     Boolean           @default(false)
  painLevel         Int               @default(0)
  painTriggers      String[]          @default([])
  avoidMovements    String[]          @default([])
  inPhysicalTherapy Boolean           @default(false)
  notes             String?
  updatedAt         DateTime          @updatedAt
  healthProfile     UserHealthProfile @relation(fields: [healthProfileId], references: [id], onDelete: Cascade)

  @@index([healthProfileId])
}

model UserNutritionProfile {
  id                      String       @id @default(cuid())
  userId                  String       @unique
  updatedAt               DateTime     @updatedAt
  isHalal                 Boolean      @default(false)
  isKosher                Boolean      @default(false)
  isVegetarian            Boolean      @default(false)
  isVegan                 Boolean      @default(false)
  isPescatarian           Boolean      @default(false)
  isKeto                  Boolean      @default(false)
  isLowCarb               Boolean      @default(false)
  isPaleo                 Boolean      @default(false)
  isLowSodium             Boolean      @default(false)
  allergyPeanuts          Boolean      @default(false)
  allergyTreeNuts         Boolean      @default(false)
  allergyMilk             Boolean      @default(false)
  allergyEggs             Boolean      @default(false)
  allergyGluten           Boolean      @default(false)
  allergySoy              Boolean      @default(false)
  allergyFish             Boolean      @default(false)
  allergyShellfish        Boolean      @default(false)
  allergySesame           Boolean      @default(false)
  otherAllergies          String[]     @default([])
  lactoseIntolerant       Boolean      @default(false)
  glutenSensitive         Boolean      @default(false)
  fodmapSensitive         Boolean      @default(false)
  dislikedFoods           String[]     @default([])
  dislikedCategories      String[]     @default([])
  cookingSkillLevel       CookingLevel @default(INTERMEDIATE)
  maxCookingTimeMin       Int          @default(30)
  willingToBatchCook      Boolean      @default(false)
  hasKitchenAccess        Boolean      @default(true)
  hasBlender              Boolean      @default(false)
  hasAirFryer             Boolean      @default(false)
  budgetLevel             BudgetLevel  @default(MODERATE)
  monthlyFoodBudgetEGP    Int?
  mealsPerDay             Int          @default(3)
  snacksPerDay            Int          @default(1)
  eatsBreakfast           Boolean      @default(true)
  breakfastTime           String?
  lunchTime               String?
  dinnerTime              String?
  doesIntermittentFasting Boolean      @default(false)
  fastingWindowStart      String?
  fastingWindowEnd        String?
  preferLocalEgyptianFood Boolean      @default(true)
  preferSimpleRecipes     Boolean      @default(true)
  likesSpicyFood          Boolean      @default(true)
  takesProteinPowder      Boolean      @default(false)
  proteinPowderType       String?
  takesCreatine           Boolean      @default(false)
  takesPreWorkout         Boolean      @default(false)
  otherSupplements        String[]     @default([])
  useCalculatedMacros     Boolean      @default(true)
  customCalories          Int?
  customProteinG          Int?
  customCarbsG            Int?
  customFatG              Int?
  user                    User         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserLifestyleProfile {
  id                    String                @id @default(cuid())
  userId                String                @unique
  updatedAt             DateTime              @updatedAt
  occupation            String?
  workType              WorkType              @default(SEDENTARY)
  workHoursPerDay       Int                   @default(8)
  dailyStepsEstimate    Int                   @default(5000)
  hasPhysicalHobbies    Boolean               @default(false)
  physicalHobbies       String[]              @default([])
  averageSleepHours     Float                 @default(7)
  sleepQuality          SleepQuality          @default(FAIR)
  typicalBedtime        String?
  typicalWakeTime       String?
  hasSleepDisorder      Boolean               @default(false)
  currentStressLevel    StressLevel           @default(MODERATE)
  mainStressors         String[]              @default([])
  hasAnxiety            Boolean               @default(false)
  preferredWorkoutTime  WorkoutTimePreference @default(ANYTIME)
  availableMonday       Boolean               @default(true)
  availableTuesday      Boolean               @default(true)
  availableWednesday    Boolean               @default(true)
  availableThursday     Boolean               @default(true)
  availableFriday       Boolean               @default(true)
  availableSaturday     Boolean               @default(true)
  availableSunday       Boolean               @default(true)
  maxWorkoutMinutes     Int                   @default(60)
  minWorkoutMinutes     Int                   @default(30)
  targetWorkoutsPerWeek Int                   @default(4)
  recoveryCapacity      RecoveryCapacity      @default(AVERAGE)
  doesStretching        Boolean               @default(false)
  doesYogaMobility      Boolean               @default(false)
  caffeineIntakeDaily   Int                   @default(2)
  smoker                Boolean               @default(false)
  alcoholDrinksPerWeek  Int                   @default(0)
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserBodyComposition {
  id                 String         @id @default(cuid())
  userId             String         @unique
  updatedAt          DateTime       @updatedAt
  currentWeightKg    Float
  heightCm           Float
  bmi                Float?
  bodyFatPercent     Float?
  bodyFatMethod      BodyFatMethod?
  leanMassKg         Float?
  fatMassKg          Float?
  neckCm             Float?
  shouldersCm        Float?
  chestCm            Float?
  waistCm            Float?
  hipsGlutesCm       Float?
  leftBicepCm        Float?
  rightBicepCm       Float?
  leftThighCm        Float?
  rightThighCm       Float?
  leftCalfCm         Float?
  rightCalfCm        Float?
  waistToHipRatio    Float?
  waistToHeightRatio Float?
  bodyType           BodyType?
  frameSize          FrameSize?
  user               User           @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model DailyReadinessLog {
  id                   String            @id @default(cuid())
  userId               String
  loggedAt             DateTime          @default(now())
  energyLevel          Int
  motivationLevel      Int
  moodLevel            Int
  overallReadiness     Int
  sleepHours           Float?
  sleepQuality         Int?
  anyPainToday         Boolean           @default(false)
  painAreas            String[]          @default([])
  painIntensity        Int?
  musclesSore          Boolean           @default(false)
  soreAreas            String[]          @default([])
  sorenessLevel        Int?
  feelingIll           Boolean           @default(false)
  restingHeartRate     Int?
  hrvScore             Int?
  stressYesterday      Int?
  alcoholYesterday     Boolean           @default(false)
  hydratedWell         Boolean           @default(true)
  recommendedIntensity WorkoutIntensity?
  shouldSkipWorkout    Boolean           @default(false)
  notes                String?
  user                 User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([loggedAt])
}

model WorkoutFeedback {
  id                    String           @id @default(cuid())
  workoutLogId          String           @unique
  userId                String
  loggedAt              DateTime         @default(now())
  overallRating         Int
  perceivedDifficulty   Int
  enjoymentLevel        Int
  performanceVsExpected PerformanceLevel
  formQuality           Int
  anyPainDuringWorkout  Boolean          @default(false)
  painExercises         String[]         @default([])
  feltTooEasy           Boolean          @default(false)
  feltTooHard           Boolean          @default(false)
  favoriteExercise      String?
  leastFavoriteExercise String?
  wantMoreOf            String?
  wantLessOf            String?
  notes                 String?
  user                  User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutLog            WorkoutLog       @relation(fields: [workoutLogId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model MuscleRecoveryStatus {
  id                      String      @id @default(cuid())
  userId                  String
  muscleGroup             MuscleGroup
  lastWorkedAt            DateTime?
  lastWorkoutSets         Int         @default(0)
  lastWorkoutRPE          Int         @default(5)
  recoveryPercent         Int         @default(100)
  estimatedFullRecoveryAt DateTime?
  currentSoreness         Int         @default(0)
  setsThisWeek            Int         @default(0)
  targetSetsPerWeek       Int         @default(10)
  updatedAt               DateTime    @updatedAt
  user                    User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, muscleGroup])
  @@index([userId])
}

model UserTrainingHistory {
  id                     String          @id @default(cuid())
  userId                 String          @unique
  trainingStartDate      DateTime?
  totalYearsTraining     Float           @default(0)
  currentLevel           ExperienceLevel @default(BEGINNER)
  previousPrograms       String[]        @default([])
  sportsBackground       String[]        @default([])
  preferredTrainingStyle TrainingStyle   @default(TRADITIONAL)
  preferredSplitType     SplitType       @default(FULL_BODY)
  preferredRepRange      RepRange        @default(MODERATE)
  bestProgressMade       String?
  whatWorkedBest         String?
  whatDidntWork          String?
  totalWorkoutsLogged    Int             @default(0)
  longestStreak          Int             @default(0)
  averageWorkoutsPerWeek Float           @default(0)
  consistencyScore       Int             @default(50)
  prBenchPressKg         Float?
  prSquatKg              Float?
  prDeadliftKg           Float?
  prPullUps              Int?
  prPushUps              Int?
  prPlankSeconds         Int?
  updatedAt              DateTime        @updatedAt
  user                   User            @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserGoalsProfile {
  id                       String             @id @default(cuid())
  userId                   String             @unique
  updatedAt                DateTime           @updatedAt
  primaryGoal              FitnessGoal
  primaryGoalTarget        String?
  targetDate               DateTime?
  secondaryGoals           FitnessGoal[]
  targetWeightKg           Float?
  targetBodyFatPercent     Float?
  targetStrength           String?
  targetEndurance          String?
  mainMotivation           MotivationType
  secondaryMotivations     MotivationType[]
  biggestBarriers          String[]           @default([])
  previousFailures         String[]           @default([])
  accountabilityPreference AccountabilityType @default(SELF)
  hasWorkoutPartner        Boolean            @default(false)
  wantsReminders           Boolean            @default(true)
  confidenceLevel          Int                @default(5)
  commitmentLevel          Int                @default(7)
  patienceForResults       Int                @default(5)
  user                     User               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserFastingProfile {
  id                      String             @id @default(cuid())
  userId                  String             @unique
  doesIntermittentFasting Boolean            @default(false)
  ifProtocol              IFProtocol?
  eatingWindowStart       String?
  eatingWindowEnd         String?
  observesRamadan         Boolean            @default(false)
  ramadanActive           Boolean            @default(false)
  ramadanIftarTime        String?
  ramadanSuhoorTime       String?
  ramadanWorkoutTiming    RamadanWorkoutTime @default(AFTER_IFTAR)
  ramadanReduceIntensity  Boolean            @default(true)
  ramadanReduceVolume     Boolean            @default(true)
  updatedAt               DateTime           @updatedAt
  user                    User               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum UserRole {
  USER
  TRAINER
  ADMIN
}

enum Gender {
  MALE
  FEMALE
}

enum FitnessGoal {
  LOSE_WEIGHT
  BUILD_MUSCLE
  MAINTAIN
  IMPROVE_HEALTH
  INCREASE_STRENGTH
  IMPROVE_ENDURANCE
}

enum ActivityLevel {
  SEDENTARY
  LIGHTLY_ACTIVE
  MODERATELY_ACTIVE
  VERY_ACTIVE
  EXTREMELY_ACTIVE
}

enum DifficultyLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum MuscleGroup {
  CHEST
  BACK
  SHOULDERS
  BICEPS
  TRICEPS
  FOREARMS
  ABS
  OBLIQUES
  LOWER_BACK
  GLUTES
  QUADRICEPS
  HAMSTRINGS
  CALVES
  FULL_BODY
  CARDIO
}

enum EquipmentType {
  NONE
  BODYWEIGHT
  DUMBBELLS
  BARBELL
  KETTLEBELL
  CABLES
  MACHINES
  RESISTANCE_BANDS
  TRX
  PULL_UP_BAR
  BENCH
  STABILITY_BALL
  FOAM_ROLLER
  JUMP_ROPE
  TREADMILL
  BIKE
  ROWING
}

enum ExerciseCategory {
  STRENGTH
  CARDIO
  FLEXIBILITY
  BALANCE
  PLYOMETRIC
  OLYMPIC
  CALISTHENICS
  YOGA
  PILATES
  MOBILITY
}

enum VideoCategory {
  YOGA
  CALISTHENICS
  HIIT
  STRETCHING
  MEDITATION
  STRENGTH
  CARDIO
  TUTORIAL
}

enum WorkoutStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  SKIPPED
}

enum MealType {
  BREAKFAST
  LUNCH
  DINNER
  SNACK
  PRE_WORKOUT
  POST_WORKOUT
}

enum SubscriptionTier {
  FREE
  PREMIUM
  PREMIUM_PLUS
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  TRIAL
}

enum TrainerStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  SUSPENDED
}

enum TrainerTier {
  REGULAR
  TRUSTED_PARTNER
}

enum TransactionType {
  SUBSCRIPTION
  PROGRAM_PURCHASE
  TIP
  PAYOUT
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
  PAID_OUT
}

enum ProgramStatus {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
  ARCHIVED
}

enum MessageType {
  TEXT
  IMAGE
  VOICE
  WORKOUT_SHARE
  PROGRESS_SHARE
}

enum AIQueryType {
  WORKOUT
  NUTRITION
  FORM
  PROGRESS
  GENERAL
}

enum TrainingLocation {
  HOME
  COMMERCIAL_GYM
  HOME_GYM
  OUTDOOR
  HOTEL
}

enum BenchType {
  FLAT
  INCLINE
  DECLINE
  ADJUSTABLE
}

enum InjuryBodyPart {
  NECK
  SHOULDER
  ROTATOR_CUFF
  ELBOW
  WRIST
  HAND
  UPPER_BACK
  LOWER_BACK
  SPINE_DISC
  HIP
  GROIN
  KNEE
  ACL
  MCL
  MENISCUS
  ANKLE
  ACHILLES
  FOOT
  OTHER
}

enum InjuryType {
  STRAIN
  SPRAIN
  TEAR
  TENDINITIS
  BURSITIS
  FRACTURE
  IMPINGEMENT
  HERNIATION
  ARTHRITIS
  CHRONIC_PAIN
  POST_SURGERY
  OTHER
}

enum InjurySeverity {
  MILD
  MODERATE
  SEVERE
  RECOVERING
  FULLY_HEALED
}

enum CookingLevel {
  NONE
  BASIC
  INTERMEDIATE
  ADVANCED
}

enum BudgetLevel {
  VERY_LOW
  LOW
  MODERATE
  HIGH
  NO_LIMIT
}

enum WorkType {
  SEDENTARY
  LIGHT
  MODERATE
  ACTIVE
  VERY_ACTIVE
}

enum SleepQuality {
  POOR
  FAIR
  GOOD
  EXCELLENT
}

enum StressLevel {
  LOW
  MODERATE
  HIGH
  VERY_HIGH
}

enum WorkoutTimePreference {
  EARLY_MORNING
  MORNING
  MIDDAY
  AFTERNOON
  EVENING
  NIGHT
  ANYTIME
}

enum RecoveryCapacity {
  LOW
  AVERAGE
  HIGH
}

enum BodyFatMethod {
  DEXA
  BODPOD
  BIA_SCALE
  CALIPERS
  NAVY_METHOD
  VISUAL_ESTIMATE
}

enum BodyType {
  ECTOMORPH
  MESOMORPH
  ENDOMORPH
  ECTO_MESO
  MESO_ENDO
}

enum FrameSize {
  SMALL
  MEDIUM
  LARGE
}

enum WorkoutIntensity {
  RECOVERY
  LIGHT
  MODERATE
  HIGH
  MAXIMUM
}

enum PerformanceLevel {
  MUCH_WORSE
  WORSE
  SAME
  BETTER
  MUCH_BETTER
}

enum ExperienceLevel {
  COMPLETE_BEGINNER
  BEGINNER
  NOVICE
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum TrainingStyle {
  TRADITIONAL
  CIRCUIT
  SUPERSETS
  HIIT
  POWERLIFTING
  BODYBUILDING
  CALISTHENICS
}

enum SplitType {
  FULL_BODY
  UPPER_LOWER
  PUSH_PULL_LEGS
  BRO_SPLIT
  HYBRID
}

enum RepRange {
  LOW
  MODERATE
  HIGH
  VARIED
}

enum MotivationType {
  HEALTH
  APPEARANCE
  STRENGTH
  PERFORMANCE
  MENTAL_HEALTH
  SOCIAL
  COMPETITION
  HABIT
  MEDICAL
}

enum AccountabilityType {
  SELF
  PARTNER
  TRAINER
  GROUP
  APP
}

enum IFProtocol {
  IF_16_8
  IF_18_6
  IF_20_4
  OMAD
  CUSTOM
}

enum RamadanWorkoutTime {
  BEFORE_FAJR
  BEFORE_IFTAR
  AFTER_IFTAR
  AFTER_TARAWEEH
  SKIP
}

// ============================================
// FITSTN COMPETITION FEATURES
// ============================================

// Health metrics tracking (blood work, vitals, etc.)
model HealthMetric {
  id        String           @id @default(cuid())
  userId    String
  type      HealthMetricType
  value     Float
  unit      String
  date      DateTime         @default(now())
  notes     String?
  source    String? // manual, device, lab
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  @@index([userId])
  @@index([type])
  @@index([date])
}

enum HealthMetricType {
  WEIGHT
  BODY_FAT_PERCENTAGE
  BLOOD_PRESSURE_SYSTOLIC
  BLOOD_PRESSURE_DIASTOLIC
  HEART_RATE_RESTING
  BLOOD_GLUCOSE_FASTING
  BLOOD_GLUCOSE_POSTPRANDIAL
  HBA1C
  TOTAL_CHOLESTEROL
  LDL_CHOLESTEROL
  HDL_CHOLESTEROL
  TRIGLYCERIDES
  CREATININE
  BUN
  HEMOGLOBIN
  VITAMIN_D
  VITAMIN_B12
  TESTOSTERONE
  CORTISOL
  TSH
  WAIST_CIRCUMFERENCE
  HIP_CIRCUMFERENCE
  SLEEP_HOURS
  WATER_INTAKE_ML
  STEPS
  CALORIES_BURNED
}

// Daily check-ins for automated follow-up
model DailyCheckIn {
  id     String   @id @default(cuid())
  userId String
  date   DateTime @default(now()) @db.Date

  // Workout feedback
  workoutCompleted Boolean?
  workoutRating    Int? // 1-5
  workoutNotes     String?

  // Nutrition feedback
  nutritionCompleted Boolean?
  nutritionRating    Int? // 1-5
  nutritionNotes     String?

  // Recovery & wellness
  sleepHours     Float?
  sleepQuality   Int? // 1-5
  energyLevel    Int? // 1-5
  stressLevel    Int? // 1-5
  musclesoreness Int? // 1-5

  // General
  mood  Int? // 1-5
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

// Scheduled calls (video/phone) with trainers
model ScheduledCall {
  id          String              @id @default(cuid())
  trainerId   String
  clientId    String
  scheduledAt DateTime
  duration    Int                 @default(30) // minutes
  type        ScheduledCallType
  status      ScheduledCallStatus @default(SCHEDULED)

  // Meeting details
  meetingUrl String? // Daily.co, Zoom, etc.
  roomName   String?

  // Notes
  agenda       String?
  trainerNotes String?
  clientNotes  String?

  // Recording
  recordingUrl String?

  // Timestamps
  startedAt DateTime?
  endedAt   DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  trainer TrainerProfile @relation(fields: [trainerId], references: [id], onDelete: Cascade)
  client  User           @relation("ScheduledCalls", fields: [clientId], references: [id], onDelete: Cascade)

  @@index([trainerId])
  @@index([clientId])
  @@index([scheduledAt])
  @@index([status])
}

enum ScheduledCallType {
  ONBOARDING
  WEEKLY_CHECKIN
  PROGRESS_REVIEW
  PROGRAM_UPDATE
  EMERGENCY
  CUSTOM
}

enum ScheduledCallStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

// Weekly progress reports (auto-generated)
model WeeklyProgressReport {
  id            String   @id @default(cuid())
  userId        String
  trainerId     String?
  weekStartDate DateTime @db.Date
  weekEndDate   DateTime @db.Date

  // Compliance stats
  workoutsPlanned   Int @default(0)
  workoutsCompleted Int @default(0)
  mealsLogged       Int @default(0)
  checkInsCompleted Int @default(0)

  // Averages
  avgWorkoutRating   Float?
  avgNutritionRating Float?
  avgSleepHours      Float?
  avgEnergyLevel     Float?
  avgMood            Float?

  // Weight change
  startWeight  Float?
  endWeight    Float?
  weightChange Float?

  // AI insights
  aiSummary         String?
  aiRecommendations String[]

  // Status
  reviewedByTrainer Boolean @default(false)
  trainerFeedback   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, weekStartDate])
  @@index([userId])
  @@index([trainerId])
  @@index([weekStartDate])
}

// Trainer notes about clients
model TrainerClientNote {
  id        String   @id @default(cuid())
  trainerId String
  clientId  String
  title     String?
  content   String
  category  String? // progress, nutrition, mindset, medical, etc.
  isPinned  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([trainerId])
  @@index([clientId])
  @@index([createdAt])
}
